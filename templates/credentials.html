{% extends "base.html" %}
{% block content %}

<a href="./create/" type="button" class="btn btn-success mb-2">Create secret</a>

{% for secret in secrets %}

<div class="card mb-3 border-light">
    <div class="card-body">
        <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary"> {{ secret.name }} {% if secret.type == "kubernetes.io/ssh-auth" %}&#128273;{% endif %} </span>
            <span>
                <a href="./credentials-detail/{{ secret.name }}" type="button" class="btn btn-primary">
                    {% if not (secret.get('annotations', {}).get('cm_readonly') or secret.get('annotations', {}).get('cm_keyonly')) and secret.type != "kubernetes.io/ssh-auth" %}
                        Edit
                    {% else %}
                        View
                    {% endif %}
                </a>
                {% if not (secret.get('annotations', {}).get('cm_readonly') or secret.get('annotations', {}).get('cm_keyonly')) %}
                <button type="button" class="btn btn-danger" onclick="
                   fetch('./credentials-detail/{{ secret.name }}', {method: 'DELETE'}).then(
                       location.reload.bind(location)
                   );
                ">
                    Delete
                </button>
                {% endif %}
            </span>
        </h4>
        {% if secret.name == "workspace" %}
        <p class="alert-primary rounded p-2 mt-2">
            This secret is automatically created and updated based on the workspace settings.<br>
            All key-value pairs are loaded as environment variables in Jupyterlab.
        </p>
        {% endif %}
        <ul class="list-group mb-3">
            {% for secret_key, secret_value in secret.data.items() %}
            {% if secret_value != "" %}
            <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                    {% if secret.get('annotations').get('eoxhub-env-jupyterlab') %}
                    <span class="y-0 font-monospace"> {{ secret_key }} - <i>os.getenv("{{ secret.name }}_{{ secret_key }}")</i> </span>
                    {% elif secret.name == "workspace" %}
                    <span class="y-0 font-monospace"> {{ secret_key }} - <i>os.getenv("{{ secret_key }}")</i> </span>
                    {% else %}
                    <span class="y-0 font-monospace"> {{ secret_key }} </span>
                    {% endif %}
                </div>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
        {% if secret.type == "key-value (Opaque)" and secret.name != "workspace" %}
        <button type="submit" class="btn btn-outline-secondary btn-sm {% if secret.get('annotations').get('eoxhub-env-jupyterlab') == 'True' %} active {% endif %}"
                onclick="
               fetch('./credentials-detail/{{ secret.name }}/jupyterlab', {method: 'POST'}).then(
                   location.reload.bind(location)
               );"
        >{% if secret.get('annotations').get('eoxhub-env-jupyterlab')%}
            Inject as env var into jupyterlab <i>(click again to disable)</i>
        {% else %}
            Inject as env var into jupyterlab
        {% endif %}
        </button>
        {% endif %}
        <br>

    </div>
</div>

{% else %}

<div class="alert alert-primary my-2" role="alert">
    Currently no credentials available.
</div>

{% endfor %}

{% endblock %}
